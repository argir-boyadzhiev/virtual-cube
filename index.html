<!DOCTYPE html>

<html>
	<head>
		<title>Orientation</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<meta http-equiv='cache-control' content='no-cache'> 
        <meta http-equiv='expires' content='0'> 
        <meta http-equiv='pragma' content='no-cache'>

        <script type="importmap">
            {
              "imports": {
                "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
              }
            }
        </script>

	</head>
	
	<body>
		<h3>alpha = <span id="alpha"></span></h3>
		<h3>beta = <span id="beta"></span></h3>
		<h3>gamma = <span id="gamma"></span></h3>
		<h3>absolute = <span id="absolute"></span></h3>

		<script type="module">

            import * as THREE from "three";

			var renderer = new THREE.WebGLRenderer({antialias: true});
			renderer.setAnimationLoop(frame);

			document.body.appendChild(renderer.domElement);
			document.body.style.margin = 0;
			document.body.style.overflow = 'hidden';

			var scene = new THREE.Scene();
			scene.background = new THREE.Color('lightblue');

			var camera = new THREE.PerspectiveCamera(60, 1, 1, 100);
            
            {
                var k = 0;
                camera.position.set(6 * Math.sin(k), 2 * Math.sin(k), 6 * Math.cos(k));
		        camera.lookAt(new THREE.Vector3(0, 0, 0));
            }
            

			var light = new THREE.PointLight('white', 500);
			scene.add(light);

			var materialOrange = new THREE.MeshLambertMaterial();
			materialOrange.color.set(1, 0.1, 0);
			var materialBlack = new THREE.MeshLambertMaterial();
			materialBlack.color.set(0.01, 0.01, 0.01);
			var materialWhite = new THREE.MeshLambertMaterial();
			materialWhite.color.set('white');

			// This is so the eyes look more alive
			var materialEye = new THREE.MeshPhongMaterial();
			materialEye.color.set('black');

			var penguin = new THREE.Group();
			scene.add(penguin);

			var innerTorsoGeom = new THREE.BoxGeometry(1.0, 1.0, 1.0);
			var innerTorso = new THREE.Mesh(innerTorsoGeom, materialWhite);
			innerTorso.position.set(0, 0, 0);
			penguin.add(innerTorso);

			var outerTorsoGeom = new THREE.BoxGeometry(1.1, 1.1, 0.9);
			var outerTorso = new THREE.Mesh(outerTorsoGeom, materialBlack);
			outerTorso.position.set(0, 0, -0.1);
			penguin.add(outerTorso);

			var beakGeom = new THREE.ConeGeometry(0.1, 0.3);
			var beak = new THREE.Mesh(beakGeom, materialOrange);
			beak.position.set(0, 0.1, 0.6);
			beak.rotation.set(Math.PI * 0.5, 0, 0);
			penguin.add(beak);

			var leftEyeGeom = new THREE.SphereGeometry(0.1);
			var leftEye = new THREE.Mesh(leftEyeGeom, materialEye);
			leftEye.position.set(0.26, 0.25, 0.5);
			leftEye.scale.set(1, 1, 0.3);
			penguin.add(leftEye);

			var rightEyeGeom = new THREE.SphereGeometry(0.1);
			var rightEye = new THREE.Mesh(rightEyeGeom, materialEye);
			rightEye.position.set(-0.26, 0.25, 0.5);
			rightEye.scale.set(1, 1, 0.3);
			penguin.add(rightEye);

			var leftBrowGeom = new THREE.BoxGeometry(0.2, 0.05, 0.05);
			var leftBrow = new THREE.Mesh(leftBrowGeom, materialBlack);
			leftBrow.position.set(0.24, 0.35, 0.5);
			leftBrow.rotation.set(0, 0, Math.PI * 0.1)
			penguin.add(leftBrow);

			var rightBrowGeom = new THREE.BoxGeometry(0.2, 0.05, 0.05);
			var rightBrow = new THREE.Mesh(rightBrowGeom, materialBlack);
			rightBrow.position.set(-0.24, 0.35, 0.5);
			rightBrow.rotation.set(0, 0, Math.PI * -0.1)
			penguin.add(rightBrow);

			var tailGeom = new THREE.BoxGeometry(0.5, 0.1, 0.3);
			var tail = new THREE.Mesh(tailGeom, materialBlack);
			tail.position.set(0, -0.5, -0.5);
			tail.rotation.set(-0.1, 0, 0);
			penguin.add(tail);

			var leftLegGeom = new THREE.BoxGeometry(0.3, 0.1, 0.4);
			leftLegGeom.translate(0, 0, 0.2);
			var leftLeg = new THREE.Mesh(leftLegGeom, materialOrange);
			leftLeg.position.set(0.3, -0.52, 0.3);
			penguin.add(leftLeg);

			var rightLegGeom = new THREE.BoxGeometry(0.3, 0.1, 0.4);
			rightLegGeom.translate(0, 0, 0.2);
			var rightLeg = new THREE.Mesh(rightLegGeom, materialOrange);
			rightLeg.position.set(-0.3, -0.52, 0.3);
			penguin.add(rightLeg);

			var leftWingGeom = new THREE.BoxGeometry(0.5, 0.1, 0.4);
			leftWingGeom.translate(0.3, 0, 0);
			var leftWing = new THREE.Mesh(leftWingGeom, materialBlack);
			leftWing.position.set(0.5, 0, 0);
			penguin.add(leftWing);

			var rightWingGeom = new THREE.BoxGeometry(0.5, 0.1, 0.4);
			rightWingGeom.translate(-0.3, 0, 0);
			var rightWing = new THREE.Mesh(rightWingGeom, materialBlack);
			rightWing.position.set(-0.5, 0, 0);
			penguin.add(rightWing);

			window.addEventListener('resize', onWindowResize, false);
			onWindowResize();

			function onWindowResize(event)
			{
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight, true);
			}

			function frame(time)
			{

				var k = time / 1000;
				light.position.set(6 * Math.sin(k), 2 * Math.sin(k), 6 * Math.cos(k));
				//camera.position.set(6 * Math.sin(k), 2 * Math.sin(k), 6 * Math.cos(k));
				//camera.lookAt(new THREE.Vector3(0, 0, 0));

				var fasterK = k * 4;
				var animationK = fasterK - Math.floor(fasterK);
				if (Math.floor(fasterK) % 2 == 0) {
					animationK = 1 - animationK;
				}

				leftLeg.rotation.set(animationK * Math.PI * 0.3 + 0.1, 0, 0);
				rightLeg.rotation.set((1 - animationK) * Math.PI * 0.3 + 0.1, 0, 0);
				leftWing.rotation.set(0, Math.PI * ((1 - animationK) * 0.2 - 0.1), ((1 - animationK) * -0.2 - 0.1) * Math.PI);
				rightWing.rotation.set(0, Math.PI * (-animationK * 0.2 + 0.1), (animationK * 0.2 + 0.1) * Math.PI);
				
				penguin.rotation.set(0, 0, (animationK * 2 - 1) * Math.PI * 0.01);

				renderer.render(scene, camera);
			}

            window.addEventListener("deviceorientation", deviceOrientation, true);

			function deviceOrientation(event)
			{
				document.getElementById('alpha').innerHTML = event.alpha.toFixed(1);
				document.getElementById('beta').innerHTML = event.beta.toFixed(1);
				document.getElementById('gamma').innerHTML = event.gamma.toFixed(1);
				document.getElementById('absolute').innerHTML = event.absolute.toFixed(1);

                var gamma = 90 - event.gamma.toFixed(1);
                if (gamma > 90)
                    gamma = gamma - 180;
                gamma = gamma * Math.PI / 180;

                var p_x = 0;
                var p_y = Math.cos(gamma);
                var p_z = Math.sin(gamma);;
                //camera.position.set(6 * Math.sin(k), 2 * Math.sin(k), 6 * Math.cos(k));
                camera.position.set(p_x * 6, p_y * 6, p_z * 6);
		        camera.lookAt(new THREE.Vector3(0, 0, 0));
			}
			
		</script>
	</body>
</html>


